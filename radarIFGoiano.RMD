---
title:  "CovidBrasil"
author: "anecoo@gmail.com"
date:   "10/set/2021"
output: 
  html_document:
    toc: true
    toc_depth: 3 #default
    toc_float: false #índice não flutuará
    toc_collapsed: true
    number_sections: false #numera as seções
    #theme: lumen
---



```{r setup, include=FALSE, message=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# Radar IF Goiano {.tabset}
Em `Radar IF Goiano` são apresentados os números referentes à COVID-19 nas cidades que sediam campus do IF Goiano.
Além dos números da COVID-19, são apresentados os índices de incidência, mortalidade e letalidade.






```{r, message=FALSE, echo=FALSE, warning=FALSE}
rm(list = ls())
  
  
  setwd("D:/covid/")
  
  library(ggiraph)
  library(gmodels)
  library(ggplot2)      # gráficos animados
  library(plotly)       # gráficos animados
  library(xtable)       # tabela latex
  #library(highcharter)  # gráficos interativos
  
  source("nCalc.R")     # função para ajustar os dados
  
  library(stringr)
  library("DT")
  library(fmsb)       # radar
  
  
  #covid <- read.csv2("HIST_PAINEL_COVIDBR_20abr2021.csv", encoding = "UTF-8")
  
  covid1 <- read.csv2("HIST_PAINEL_COVIDBR_2020_Parte1_10set2021.csv", encoding = "UTF-8")
  covid2 <- read.csv2("HIST_PAINEL_COVIDBR_2020_Parte2_10set2021.csv", encoding = "UTF-8")
  covid3 <- read.csv2("HIST_PAINEL_COVIDBR_2021_Parte1_10set2021.csv", encoding = "UTF-8")
  covid4 <- read.csv2("HIST_PAINEL_COVIDBR_2021_Parte2_10set2021.csv", encoding = "UTF-8")

  covid <- rbind(covid1, covid2, covid3, covid4)
  
  covid$data <- format(as.Date(covid$data, format = "%Y-%m-%d"), "%d/%m/%Y") # Inverter a data
  
  covid$populacaoTCU2019 <- as.numeric(as.character(covid$populacaoTCU2019))
  
  dados <- subset(covid, covid$regiao == "Brasil")
  
  nDados <- nCalc(data = dados)
```


```{r, message=FALSE, echo=FALSE, warning=FALSE}
ifDados <- data.frame()
  
  ## Casos de COVID-19 registrados diariamente no Brasil
  dados <- subset(covid, regiao == "Brasil")
  #### Com a linha de média móvel para os últimos sete dias
  
  # Brasil
  nDados <- nCalc(dados)
  
  ifDados <- rbind(ifDados, nDados)
  ifDados$estado <- "BR"
  
  
  
  # Goiás
  dados <- subset(covid, is.na(codmun) & estado == "GO")
  nDados <- nCalc(dados)
  
  ifDados <- rbind(ifDados, nDados)
  
  
  # IFGoiano
  
  local <- c("Goiânia", "Campos Belos", "Catalão", "Ceres", "Cristalina",
             "Hidrolândia", "Ipameri", "Iporá", "Morrinhos", "Posse", "Rio Verde",
             "Trindade", "Urutaí")
  
  for(i in local){
    
    dados <- subset(covid, estado == "GO" & municipio == i)
    nDados <- nCalc(dados)
    
    ifDados <- rbind(ifDados, nDados)
    
  }
  
  ifDados$populacaoTCU2019 <- as.integer(ifDados$populacaoTCU2019)
  
```



## Mortes por 100 mil habitantes
Número de  mortes por COVID-19 nos municípios que sediam campus do IF Goiano.

(ordenação decrescente)

```{r, message=FALSE, echo=FALSE, warning=FALSE}
hoje <- tail(ifDados$data, 1)
  
  resumo <- subset(ifDados, data == hoje)
  colnames(resumo) <- c("Estado", "Local", "Data", "População", "CasosTotal", 
                        "CasosNovos", "ÓbitosTotal", "ÓbitosNovos", "Inc.", "Mort.", "Let.", 
                        "mmOn", "mmCn")
  resumo$Local <- as.character(resumo$Local)
  
  # retirar, se necessário

    j <- seq(from = 2, to = 30, by = 2)
    resumo <- resumo[j, ]  
 
  #  resumo <- resumo[, c(2, 4:11)]
 
  #resumo <- resumo[c(2,4:17), ]  
  
  resumo$Local[1] <- "BR"
  
  resumo$Local[2] <- "GO"
  
  
  
  # Ordenado por população
  #resumo <- resumo[order(resumo$População, decreasing= TRUE), ] 
  
  # Ordenado por mortes
  resumo <- resumo[order(resumo$Mort., decreasing= TRUE), ] 
  
  # Mortalidade: número de mortes por 100 mil habitantes
  
  nc <- data.frame()
  
  nc <- rbind(nc, resumo$Mort.)
  colnames(nc) <- resumo$Local
  
  nc <- rbind(nc, 0)
  nc <- rbind(nc, nc[1,])
  nc[1, ] <- 500 #Valor máximo
  
  # Ordenado por distãncia em relação à Goiânia
  #nc <- nc[, c(1:3, 14,8, 11,15,6,9, 10, 13,5, 7, 12, 4)]
  
  
  
  titulo <- paste0(tail(dados$data, 1), " :: Mortes por 100 mil habitantes.")
  
  radarchart(nc, axistype=1, 
             
             #custom polygon
             pcol=rgb(0.2,0.5,0.5,0.9) , pfcol=rgb(0.2,0.5,0.5,0.5), plwd=3, 
             
             #custom the grid
             cglcol="blue", cglty=1, axislabcol="red", caxislabels=seq(0, nc[1,1], nc[1,1]/4), cglwd=1,
             
             #custom labels
             vlcex=0.9, 
             
             title = titulo
  )
  
  
  #resumo[which.max(resumo$Mort.), ]
```



## Mortes por casos notificados
Percentual de mortes por casos notificados para os municípios que sediam campus do IF Goiano.

(ordenação decrescente)

```{r, message=FALSE, echo=FALSE, warning=FALSE}
# Ordenado por mortes
  resumo <- resumo[order(resumo$Let., decreasing= TRUE), ] 
  
  nc <- data.frame()
  
  nc <- rbind(nc, resumo$Let.)
  colnames(nc) <- resumo$Local
  
  nc <- rbind(nc, 0)
  nc <- rbind(nc, nc[1,])
  nc[1, ] <- ceiling(max(nc[3, ])) # valor máximo das cidades arredondado para cima
  
  
  titulo <- paste0(tail(dados$data, 1), " :: Mortes por casos notificados (%)")
  radarchart(nc, axistype=1, 
             
             #custom polygon
             pcol=rgb(0.2,0.5,0.5,0.9) , pfcol=rgb(0.2,0.5,0.5,0.5), plwd=3, 
             
             #custom the grid
             cglcol="blue", cglty=1, axislabcol="red", caxislabels=seq(0, nc[1,1], nc[1,1]/4), cglwd=1,
             
             #custom labels
             vlcex=0.8, 
             
             title = titulo
  )

```

## Índices por município


Em `r resumo[which.max(resumo$Let.), 3]`, `r resumo[which.max(resumo$Let.), 2]` apresentou uma maior letalidade (percentual de mortes por casos notificados).

```{r, message=F, echo=F}
  #resumo[which.max(resumo$Let.), 2]
  
  DT::datatable(resumo[, c(2, 4:11)], caption = "Ordenado pela Letalidade", rownames = F, options = list(pageLength = 15))
```

Incidência (*Inc.*) - Casos Acumulados por 100mil habitantes.

Mortalidade (*Mort.*) - Óbitos Acumulados por 100mil habitantes.

Letalidade (*Let.*) - Óbitos Acumulados / Casos Acumulados * 100.

anecoo@gmail.com, ano#2021
